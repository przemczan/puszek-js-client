!function(a){a.Puszek=a.Puszek||{}}(window),function(a){function b(){var a=this,b={id:++c,type:null,data:null};this.data=function(c){return b.data=c,a},this.type=function(c){return b.type=c,a},this.send=function(c){return c.send(JSON.stringify(b)),a}}a.Puszek.SocketRequest={TYPE_MESSAGE_MARK_AS_READ:"message_mark_as_read",create:function(){return new b}};var c=0}(window,jQuery),function(a,b){function c(){var a=this,c={message:null,sender:null,receivers:[]};this.message=function(b){return c.message=b,a},this.sender=function(b){return c.sender=b,a},this.receivers=function(d){if(!b.isArray(d))throw"Message receivers have to be an array";return c.receivers=d,a},this.get=function(){return c}}a.Puszek.SocketRequest.Message={create:function(){return new c}}}(window,jQuery),function(a){function b(){var a=this,b=[];this.ids=function(c){return b=c,a},this.push=function(c){return b.push(c),a},this.get=function(){return b}}a.Puszek.SocketRequest.MessageIdList={create:function(){return new b}}}(window,jQuery),function(a,b){a.Puszek.Socket=function(a){function c(){l=k.autoReconnectRetries,i.trigger("open")}function d(){h&&k.autoReconnectRetries>0&&(l--?setTimeout(function(){j.reconnect()},k.autoReconnectDelay):l=k.autoReconnectRetries),i.trigger("close")}function e(){i.trigger("error")}function f(a){try{var b=JSON.parse(a.data);i.trigger("pre.packet",[b]),i.trigger("packet",[b]),i.trigger("post.packet",[b])}catch(c){}}function g(){h=new WebSocket(k.address),h.onerror=e,h.onopen=c,h.onclose=d,h.onmessage=f}var h,i=b(this),j=this,k={address:"ws://localhost:5001",serverProtocol:null,autoReconnectRetries:1e3,autoReconnectDelay:5e3},l=k.autoReconnectRetries;this.configure=function(a){return k=b.extend(!0,k,a),j},this.getConfiguration=function(){return k},this.connect=function(a){return k.address=a||k.address,g(),j},this.disconnect=function(){if(h){var a=h;h=!1,a.close(),a=null}return j},this.reconnect=function(){return j.disconnect(),j.connect(),j},this.isConnected=function(){return h&&1==h.readyState},this.send=function(a){return h&&1==h.readyState&&h.send(a),j},this.markAsRead=function(a){return j.send(Puszek.SocketRequest.TYPE_MESSAGE_MARK_AS_READ,Puszek.SocketRequest.MessageIdList.create().ids(a).get()),j},this.on=function(){return i.on.apply(i,arguments),j},this.off=function(){return i.off.apply(i,arguments),j},this.send=function(a,b){return h&&Puszek.SocketRequest.create().type(a).data(b).send(h),j},"object"==typeof a&&this.configure(a)}}(window,jQuery);